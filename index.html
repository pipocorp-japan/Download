<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三菱トレインビジョン再現 (レガシーブラウザ対応版)</title>
    <style>
        body {
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            font-family: "Helvetica Neue", Helvetica, "Hiragino Kaku Gothic ProN", sans-serif;
            overflow: hidden;
            color: #333;
        }

        .monitor {
            width: 100vw;
            height: 56.25vw;
            max-width: 1280px;
            max-height: 720px;
            background-color: #fff;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        /* ヘッダー: Android 4.4向けにベンダープレフィックスを追加 */
        .header-top {
            position: absolute;
            top: 5%;
            left: 5%;
            right: 5%;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            justify-content: space-between;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            z-index: 10;
        }

        .info-left {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
        }

        /* 種別: 塗りつぶしが適用されない対策として display: block を明示 */
        .type-container-wrap {
            position: relative;
            width: 14vw;
            height: 4.5vw;
            margin-right: 20px;
            background: transparent;
        }

        .type-box {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0000ff !important; /* 強制適用 */
            color: #ffffff;
            border-radius: 8px;
            font-size: 2.2vw;
            font-weight: bold;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            opacity: 0;
            -webkit-transition: opacity 0.4s linear;
            transition: opacity 0.4s linear;
        }
        .type-box.active { opacity: 1; }

        .dest-wrap {
            position: relative;
            height: 3.5vw;
            width: 30vw;
        }

        /* 号車表示 */
        .car-info-group {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            font-size: 2.2vw;
            font-weight: bold;
        }

        .car-number-box {
            background-color: #888888 !important;
            color: #ffffff;
            width: 3.2vw;
            height: 3.2vw;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            border-radius: 4px;
            font-size: 2.5vw;
            margin: 0 10px;
        }

        .car-label-side {
            position: relative;
            height: 3.2vw;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
        }
        .label-before { width: 8vw; -webkit-box-pack: end; -webkit-justify-content: flex-end; justify-content: flex-end; }
        .label-after { width: 6vw; -webkit-box-pack: start; -webkit-justify-content: flex-start; justify-content: flex-start; }

        .fade-container {
            position: absolute;
            opacity: 0;
            -webkit-transition: opacity 0.4s linear;
            transition: opacity 0.4s linear;
            white-space: nowrap;
        }
        .fade-container.active { opacity: 1; }

        /* メイン表示 */
        .main-display {
            position: absolute;
            top: 32%;
            width: 100%;
            height: 40%;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            padding: 0 5%;
            box-sizing: border-box;
        }

        .fixed-elements {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
        }

        .label-wrap {
            position: relative;
            width: 10vw;
            height: 5vw;
            font-size: 3.5vw;
            font-weight: bold;
        }

        .numbering-fixed {
            height: 9vw;
            width: 9vw;
            margin-left: 2vw;
            display: block;
        }

        /* Android 4.4では 3D Cube が重なるため、シンプルな平面切り替えにフォールバックさせるための構造 */
        .station-stage {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            height: 100%;
            margin-left: 4vw;
            overflow: hidden; /* はみ出し防止 */
        }

        .cube-text {
            width: 100%;
            height: 100%;
            position: relative;
            -webkit-transform-style: preserve-3d;
            transform-style: preserve-3d;
            -webkit-transition: -webkit-transform 0.6s linear;
            transition: transform 0.6s linear;
        }

        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            background: #ffffff; /* 重なり対策：背景を白に */
        }

        /* translateZ の値を少し小さく調整 */
        .face-jp { -webkit-transform: rotateX(0deg) translateZ(5vw); transform: rotateX(0deg) translateZ(5vw); }
        .face-en { -webkit-transform: rotateX(90deg) translateZ(5vw); transform: rotateX(90deg) translateZ(5vw); }
        .face-zh { -webkit-transform: rotateX(180deg) translateZ(5vw); transform: rotateX(180deg) translateZ(5vw); }
        .face-ko { -webkit-transform: rotateX(270deg) translateZ(5vw); transform: rotateX(270deg) translateZ(5vw); }

        .station-text { font-size: 9.5vw; font-weight: 900; letter-spacing: -2px; }

        /* 設定ボタン */
        .config-btn {
            position: fixed; bottom: 15px; right: 15px;
            width: 44px; height: 44px; background: #eee;
            border: 1px solid #ccc; border-radius: 22px; z-index: 1000; font-size: 20px;
        }

        .settings-panel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; background: rgba(0,0,0,0.9);
            z-index: 9999; color: white; padding: 10px; display: none; overflow-y: scroll;
        }
        .setting-group { margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .setting-group label { display: block; font-size: 12px; color: #ccc; }
        .setting-group input { width: 100%; padding: 8px; font-size: 14px; margin-top: 3px; }
    </style>
</head>
<body>

    <div class="monitor">
        <div class="header-top">
            <div class="info-left">
                <div class="type-container-wrap" id="type-container">
                    <div class="type-box active">各駅停車</div>
                    <div class="type-box">Local</div>
                    <div class="type-box">各站停车</div>
                    <div class="type-box">보통</div>
                </div>
                <div class="dest-wrap" id="dest-container">
                    <div class="fade-container active" id="d-dest-jp">西船橋 行き</div>
                    <div class="fade-container" id="d-dest-en">for Nishi-Funabashi</div>
                    <div class="fade-container" id="d-dest-zh">开往 西船桥</div>
                    <div class="fade-container" id="d-dest-ko">니시후나バ시 行</div>
                </div>
            </div>

            <div class="car-info-group">
                <div class="car-label-side label-before" id="car-before-container">
                    <div class="fade-container"></div>
                    <div class="fade-container active">Car no.</div>
                    <div class="fade-container"></div>
                    <div class="fade-container"></div>
                </div>
                <div class="car-number-box" id="d-car-num">1</div>
                <div class="car-label-side label-after" id="car-after-container">
                    <div class="fade-container active">号車</div>
                    <div class="fade-container"></div>
                    <div class="fade-container">号车</div>
                    <div class="fade-container">호차</div>
                </div>
            </div>
        </div>

        <div class="main-display">
            <div class="fixed-elements">
                <div class="label-wrap" id="label-container">
                    <div class="fade-container active">次は</div>
                    <div class="fade-container">Next</div>
                    <div class="fade-container">下一站</div>
                    <div class="fade-container">다음은</div>
                </div>
                <img class="numbering-fixed" id="d-num-fixed" src="https://pipocorp-japan.github.io/asset/Newpipo.jpg">
            </div>

            <div class="station-stage">
                <div class="cube-text" id="cube">
                    <div class="face face-jp"><span class="station-text" id="d-jp">ピポラボ</span></div>
                    <div class="face face-en"><span class="station-text" id="d-en">pipoLab</span></div>
                    <div class="face face-zh"><span class="station-text" id="d-zh">皮波实验室</span></div>
                    <div class="face face-ko"><span class="station-text" id="d-ko">피포라 보라토리</span></div>
                </div>
            </div>
        </div>
    </div>

    <button class="config-btn" onclick="openCfg()">⚙</button>

    <div id="cfg-panel" class="settings-panel">
        <h3>設定</h3>
        <div class="setting-group">
            <label>駅名</label>
            <input type="text" id="i-jp" value="ピポラボ">
            <input type="text" id="i-en" value="pipoLab">
            <input type="text" id="i-zh" value="皮波实验室">
            <input type="text" id="i-ko" value="피포라 보라토리">
        </div>
        <div class="setting-group">
            <label>行先</label>
            <input type="text" id="i-dest-jp" value="西船橋 行き">
            <input type="text" id="i-dest-en" value="for Nishi-Funabashi">
        </div>
        <div class="setting-group">
            <label>号車 / ナンバリングURL</label>
            <input type="text" id="i-car-num" value="1">
            <input type="text" id="i-num" value="https://pipocorp-japan.github.io/asset/Newpipo.jpg">
        </div>
        <button onclick="saveCfg()" style="padding:10px; width:100%;">保存</button>
        <button onclick="closeCfg()" style="padding:10px; width:100%; margin-top:5px;">閉じる</button>
    </div>

    <script>
        var cube = document.getElementById('cube');
        var step = 0;

        // Android 4.4向けに、3D変形が効かない場合のフォールバック処理を検討
        function updateAllTranslations() {
            step++;
            var index = step % 4;
            var angle = step * -90; 
            
            // ベンダープレフィックス付きで回転
            cube.style.webkitTransform = "rotateX(" + angle + "deg)";
            cube.style.transform = "rotateX(" + angle + "deg)";

            toggleFade('label-container', index);
            toggleFade('dest-container', index);
            toggleFade('type-container', index);
            toggleFade('car-before-container', index);
            toggleFade('car-after-container', index);
        }

        function toggleFade(parentId, index) {
            var parent = document.getElementById(parentId);
            if(!parent) return;
            var items = parent.children;
            for(var i=0; i<items.length; i++) {
                items[i].classList.remove('active');
            }
            if(items[index]) items[index].classList.add('active');
        }

        setInterval(updateAllTranslations, 3600);

        function saveCfg() {
            var cfg = {
                jp: document.getElementById('i-jp').value,
                en: document.getElementById('i-en').value,
                zh: document.getElementById('i-zh').value,
                ko: document.getElementById('i-ko').value,
                destJp: document.getElementById('i-dest-jp').value,
                destEn: document.getElementById('i-dest-en').value,
                carNum: document.getElementById('i-car-num').value,
                num: document.getElementById('i-num').value
            };
            localStorage.setItem('tv_v13_config', JSON.stringify(cfg));
            apply(cfg);
            closeCfg();
        }

        function apply(cfg) {
            document.getElementById('d-jp').innerText = cfg.jp;
            document.getElementById('d-en').innerText = cfg.en;
            document.getElementById('d-zh').innerText = cfg.zh;
            document.getElementById('d-ko').innerText = cfg.ko;
            document.getElementById('d-dest-jp').innerText = cfg.destJp;
            document.getElementById('d-dest-en').innerText = cfg.destEn;
            document.getElementById('d-car-num').innerText = cfg.carNum;
            document.getElementById('d-num-fixed').src = cfg.num;
        }

        function openCfg() { document.getElementById('cfg-panel').style.display = 'block'; }
        function closeCfg() { document.getElementById('cfg-panel').style.display = 'none'; }

        window.onload = function() {
            var saved = localStorage.getItem('tv_v13_config');
            if(saved) apply(JSON.parse(saved));
        };
    </script>
</body>
</html>
