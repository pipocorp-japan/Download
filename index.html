<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三菱トレインビジョン再現 (号車UI統一版)</title>
    <style>
        body {
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            font-family: "Helvetica Neue", Helvetica, "Hiragino Kaku Gothic ProN", sans-serif;
            overflow: hidden;
            color: #333;
        }

        .monitor {
            width: 100vw;
            height: 56.25vw;
            max-width: 1280px;
            max-height: 720px;
            background-color: #fff;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        /* 上部ヘッダー */
        .header-top {
            position: absolute;
            top: 40px;
            left: 60px;
            right: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .info-left {
            display: flex;
            align-items: center;
        }

        /* 種別 */
        .type-container-wrap {
            position: relative;
            width: 14vw;
            height: 4.5vw;
            margin-right: 20px;
        }

        .type-box {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0000ff;
            color: white;
            border-radius: 12px;
            font-size: 2.2vw;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s linear;
        }
        .type-box.active { opacity: 1; }

        /* 行先 */
        .dest-wrap {
            position: relative;
            height: 3.5vw;
            width: 30vw;
        }

        /* 号車表示エリア (数字ボックスを固定) */
        .car-info-group {
            display: flex;
            align-items: center;
            font-size: 2.2vw;
            font-weight: bold;
        }

        /* 数字を囲う灰色の角丸正方形 (全言語共通でここに固定) */
        .car-number-box {
            background-color: #888;
            color: white;
            width: 3.2vw;
            height: 3.2vw;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 2.5vw;
            margin: 0 10px;
        }

        /* ラベル（号車 / Car no. / ...）のフェード用コンテナ */
        .car-label-side {
            position: relative;
            height: 3.2vw;
            display: flex;
            align-items: center;
        }

        .label-before { width: 8vw; justify-content: flex-end; } /* Car no. 用 */
        .label-after { width: 6vw; justify-content: flex-start; }  /* 号車 用 */

        /* 共通：フェードテキスト */
        .fade-container {
            position: absolute;
            opacity: 0;
            transition: opacity 0.4s linear;
            white-space: nowrap;
        }
        .fade-container.active { opacity: 1; }

        /* メイン表示 */
        .main-display {
            position: absolute;
            top: 32%;
            width: 100%;
            height: 40%;
            display: flex;
            align-items: center;
            padding: 0 60px;
            box-sizing: border-box;
        }

        .fixed-elements {
            display: flex;
            align-items: center;
            height: 100%;
        }

        .label-wrap {
            position: relative;
            width: 10vw;
            height: 60px;
            font-size: 3.5vw;
            font-weight: bold;
        }

        .numbering-fixed {
            height: 9vw;
            width: 9vw;
            margin-left: 3vw;
            object-fit: contain;
            display: none;
        }

        .station-stage {
            flex: 1;
            height: 100%;
            margin-left: 4vw;
            perspective: 1000px;
        }

        .cube-text {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s linear;
        }

        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            color: #333;
        }

        .face-jp { transform: rotateX(0deg) translateZ(80px); }
        .face-en { transform: rotateX(90deg) translateZ(80px); }
        .face-zh { transform: rotateX(180deg) translateZ(80px); }
        .face-ko { transform: rotateX(270deg) translateZ(80px); }

        .station-text { font-size: 9.8vw; font-weight: 900; letter-spacing: -2px; }

        /* 設定パネル */
        .settings-panel {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            color: white;
            padding: 20px;
            box-sizing: border-box;
            display: none;
            overflow-y: auto;
        }

        .setting-group { margin-bottom: 12px; }
        .setting-group label { display: block; font-size: 11px; color: #aaa; }
        .setting-group input { 
            width: 100%; padding: 10px; font-size: 16px; border-radius: 4px; border: none; margin-top: 4px;
        }

        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-save { background: #0000ff; color: white; }
        .btn-close { background: #444; color: white; }

        .config-btn {
            position: fixed; bottom: 15px; right: 15px;
            width: 44px; height: 44px; background: rgba(0,0,0,0.05);
            color: #ccc; border: 1px solid #ddd; border-radius: 50%; z-index: 1000; font-size: 20px;
        }
    </style>
</head>
<body>

    <div class="monitor">
        <!-- 上部：種別・行先・号車 -->
        <div class="header-top">
            <div class="info-left">
                <div class="type-container-wrap" id="type-container">
                    <div class="type-box active">各駅停車</div>
                    <div class="type-box">Local</div>
                    <div class="type-box">各站停车</div>
                    <div class="type-box">보통</div>
                </div>
                <div class="dest-wrap" id="dest-container">
                    <div class="fade-container active">西船橋 行き</div>
                    <div class="fade-container">for Nishi-Funabashi</div>
                    <div class="fade-container">开往 西船桥</div>
                    <div class="fade-container">니시후나바시 行</div>
                </div>
            </div>

            <!-- 号車：Car no. [1] 号車 形式 -->
            <div class="car-info-group">
                <!-- 数字の左側に来るラベル (Car no. 用) -->
                <div class="car-label-side label-before" id="car-before-container">
                    <div class="fade-container"></div> <!-- JP: 空白 -->
                    <div class="fade-container active">Car no.</div> <!-- EN: Car no. -->
                    <div class="fade-container"></div> <!-- ZH: 空白 -->
                    <div class="fade-container"></div> <!-- KO: 空白 -->
                </div>

                <!-- 固定の数字ボックス -->
                <div class="car-number-box" id="d-car-num">1</div>

                <!-- 数字の右側に来るラベル (号車 用) -->
                <div class="car-label-side label-after" id="car-after-container">
                    <div class="fade-container active">号車</div> <!-- JP -->
                    <div class="fade-container"></div> <!-- EN: 空白 -->
                    <div class="fade-container">号车</div> <!-- ZH -->
                    <div class="fade-container">호차</div> <!-- KO -->
                </div>
            </div>
        </div>

        <!-- メイン表示 -->
        <div class="main-display">
            <div class="fixed-elements">
                <div class="label-wrap" id="label-container">
                    <div class="fade-container active">次は</div>
                    <div class="fade-container">Next</div>
                    <div class="fade-container">下一站</div>
                    <div class="fade-container">다음은</div>
                </div>
                <img class="numbering-fixed" id="d-num-fixed" src="">
            </div>

            <div class="station-stage">
                <div class="cube-text" id="cube">
                    <div class="face face-jp"><span class="station-text" id="d-jp">渋谷</span></div>
                    <div class="face face-en"><span class="station-text" id="d-en">Shibuya</span></div>
                    <div class="face face-zh"><span class="station-text" id="d-zh">涩谷</span></div>
                    <div class="face face-ko"><span class="station-text" id="d-ko">시부야</span></div>
                </div>
            </div>
        </div>
    </div>

    <button class="config-btn" onclick="openCfg()">⚙</button>

    <div id="cfg-panel" class="settings-panel">
        <h3>トレインビジョン設定</h3>
        <div class="setting-group">
            <label>行先設定 (JP / EN)</label>
            <input type="text" id="i-dest-jp" value="西船橋 行き">
            <input type="text" id="i-dest-en" value="for Nishi-Funabashi" style="margin-top:5px">
        </div>
        <div class="setting-group">
            <label>号車番号</label>
            <input type="text" id="i-car-num" value="1">
        </div>
        <div class="setting-group">
            <label>ナンバリング画像URL</label>
            <input type="text" id="i-num" placeholder="https://...">
        </div>
        <div class="setting-group">
            <label>駅名設定</label>
            <div style="display:flex; gap:2%">
                <input type="text" id="i-jp" value="渋谷" style="width:49%">
                <input type="text" id="i-en" value="Shibuya" style="width:49%">
            </div>
        </div>
        <div class="btn-row">
            <button class="btn btn-save" onclick="saveCfg()">適用・保存</button>
            <button class="btn btn-close" onclick="closeCfg()">閉じる</button>
        </div>
    </div>

    <script>
        var cube = document.getElementById('cube');
        var step = 0;

        function updateAllTranslations() {
            step++;
            var index = step % 4;
            
            // 駅名回転
            var angle = step * -90; 
            cube.style.transform = "rotateX(" + angle + "deg)";

            // フェード同期
            toggleFade('label-container', index);
            toggleFade('dest-container', index);
            toggleFade('type-container', index);
            toggleFade('car-before-container', index);
            toggleFade('car-after-container', index);
        }

        function toggleFade(parentId, index) {
            var items = document.getElementById(parentId).children;
            for(var i=0; i<items.length; i++) {
                items[i].classList.remove('active');
            }
            if(items[index]) items[index].classList.add('active');
        }

        setInterval(updateAllTranslations, 3600);

        function saveCfg() {
            var cfg = {
                destJp: document.getElementById('i-dest-jp').value,
                destEn: document.getElementById('i-dest-en').value,
                carNum: document.getElementById('i-car-num').value,
                num: document.getElementById('i-num').value,
                jp: document.getElementById('i-jp').value,
                en: document.getElementById('i-en').value
            };
            localStorage.setItem('tv_v11_config', JSON.stringify(cfg));
            apply(cfg);
            closeCfg();
        }

        function apply(cfg) {
            document.getElementById('d-dest-container-0').innerText = cfg.destJp; // 簡易
            document.getElementById('d-car-num').innerText = cfg.carNum;
            document.getElementById('d-jp').innerText = cfg.jp;
            document.getElementById('d-en').innerText = cfg.en;

            var nImg = document.getElementById('d-num-fixed');
            if(cfg.num && cfg.num.length > 5) {
                nImg.src = cfg.num;
                nImg.style.display = 'block';
            } else {
                nImg.style.display = 'none';
            }
        }

        function openCfg() { document.getElementById('cfg-panel').style.display = 'block'; }
        function closeCfg() { document.getElementById('cfg-panel').style.display = 'none'; }

        window.onload = function() {
            var saved = localStorage.getItem('tv_v11_config');
            if(saved) apply(JSON.parse(saved));
        };
    </script>
</body>
</html>
